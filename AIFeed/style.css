/* General Setup */
:root {
    --transition-speed: 0.3s;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    margin: 0;
    background-color: var(--primary-bg);
    color: var(--text-color);
    transition: background-color var(--transition-speed), color var(--transition-speed);
}

/* Theme Palettes */
:root[data-theme="default"][data-mode="light"] {
    --primary-bg: #f0f2f5; --secondary-bg: #ffffff; --sidebar-bg: #2c3e50;
    --text-color: #333333; --sidebar-text-color: #ecf0f1; --accent-color: #3498db; --hover-color: #34495e;
}
:root[data-theme="default"][data-mode="dark"] {
    --primary-bg: #1a1a1a; --secondary-bg: #2b2b2b; --sidebar-bg: #252525;
    --text-color: #e0e0e0; --sidebar-text-color: #e0e0e0; --accent-color: #3498db; --hover-color: #3a3a3a;
}

/* Theme 1: Crimson */
:root[data-theme="theme1"][data-mode="light"] {
    --primary-bg: #fdf6f6; --secondary-bg: #ffffff; --sidebar-bg: #c0392b;
    --text-color: #4c1a14; --sidebar-text-color: #fdf6f6; --accent-color: #e74c3c; --hover-color: #a52a20;
}
:root[data-theme="theme1"][data-mode="dark"] {
    --primary-bg: #2a1616; --secondary-bg: #3e2323; --sidebar-bg: #a52a20;
    --text-color: #fdeaea; --sidebar-text-color: #fdeaea; --accent-color: #e74c3c; --hover-color: #c0392b;
}

/* Theme 2: Violet */
:root[data-theme="theme2"][data-mode="light"] {
    --primary-bg: #f9f6fd; --secondary-bg: #ffffff; --sidebar-bg: #8e44ad;
    --text-color: #3d1d4c; --sidebar-text-color: #f9f6fd; --accent-color: #9b59b6; --hover-color: #732d91;
}
:root[data-theme="theme2"][data-mode="dark"] {
    --primary-bg: #1e162a; --secondary-bg: #2d233e; --sidebar-bg: #732d91;
    --text-color: #f8eaff; --sidebar-text-color: #f8eaff; --accent-color: #9b59b6; --hover-color: #8e44ad;
}

/* Theme 3: Forest */
:root[data-theme="theme3"][data-mode="light"] {
    --primary-bg: #f6fdfa; --secondary-bg: #ffffff; --sidebar-bg: #16a085;
    --text-color: #0a4c3d; --sidebar-text-color: #f6fdfa; --accent-color: #1abc9c; --hover-color: #0f8a71;
}
:root[data-theme="theme3"][data-mode="dark"] {
    --primary-bg: #162a25; --secondary-bg: #233e36; --sidebar-bg: #0f8a71;
    --text-color: #eafdf5; --sidebar-text-color: #eafdf5; --accent-color: #1abc9c; --hover-color: #16a085;
}

/* Theme 4: Amber */
:root[data-theme="theme4"][data-mode="light"] {
    --primary-bg: #fdfcf6; --secondary-bg: #ffffff; --sidebar-bg: #f39c12;
    --text-color: #4c3b0a; --sidebar-text-color: #fdfcf6; --accent-color: #f1c40f; --hover-color: #d08e0b;
}
:root[data-theme="theme4"][data-mode="dark"] {
    --primary-bg: #2a2516; --secondary-bg: #3e3623; --sidebar-bg: #d08e0b;
    --text-color: #fdfaeb; --sidebar-text-color: #fdfaeb; --accent-color: #f1c40f; --hover-color: #f39c12;
}

/* Theme 5: Ocean */
:root[data-theme="theme5"][data-mode="light"] {
    --primary-bg: #f6fafd; --secondary-bg: #ffffff; --sidebar-bg: #2980b9;
    --text-color: #143c4c; --sidebar-text-color: #f6fafd; --accent-color: #3498db; --hover-color: #206694;
}
:root[data-theme="theme5"][data-mode="dark"] {
    --primary-bg: #16222a; --secondary-bg: #23333e; --sidebar-bg: #206694;
    --text-color: #eaeffd; --sidebar-text-color: #eaeffd; --accent-color: #3498db; --hover-color: #2980b9;
}


/* App Layout */
.app-container { display: flex; height: 100vh; }
.sidebar {
    width: 250px; background-color: var(--sidebar-bg); color: var(--sidebar-text-color);
    display: flex; flex-direction: column; padding: 20px; transition: background-color var(--transition-speed);
}
.content {
    flex-grow: 1; padding: 40px; background-color: var(--secondary-bg);
    transition: background-color var(--transition-speed);
    overflow-y: auto; /* Allow content to scroll */
}

/* Sidebar components */
.app-title { font-size: 1.5em; font-weight: bold; text-align: center; margin-bottom: 30px; }
.main-nav { flex-grow: 1; }
.main-nav ul, .bottom-nav ul { list-style: none; padding: 0; margin: 0; }

.nav-item {
    display: flex; /* Changed to flex to align icon and text */
    align-items: center; /* Vertically center icon and text */
    padding: 12px 15px;
    color: var(--sidebar-text-color);
    text-decoration: none;
    border-radius: 5px;
    margin-bottom: 5px;
    transition: background-color 0.2s, color var(--transition-speed);
}

.nav-icon {
    width: 18px;
    height: 18px;
    margin-right: 10px;
    vertical-align: middle;
    filter: invert(90%) sepia(12%) saturate(95%) hue-rotate(175deg) brightness(95%) contrast(92%);
}

.nav-item:hover { background-color: var(--hover-color); }

/* Settings Modal */
.modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); }
.modal-content {
    background-color: var(--secondary-bg); color: var(--text-color); margin: 10% auto; padding: 20px;
    border: 1px solid var(--hover-color); width: 80%; max-width: 500px; border-radius: 10px; position: relative;
    transition: background-color var(--transition-speed), color var(--transition-speed);
}
.modal-content pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    background-color: var(--primary-bg);
    padding: 15px;
    border-radius: 5px;
    border: 1px solid var(--hover-color);
}
.close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; position: absolute; top: 10px; right: 20px; }
.close-button:hover, .close-button:focus { color: var(--text-color); text-decoration: none; cursor: pointer; }
.setting-section { margin-bottom: 20px; }

/* Theme Preview */
.theme-preview-box {
    height: 100px; border-radius: 8px; border: 2px solid var(--hover-color);
    margin-bottom: 20px; display: flex; overflow: hidden;
    background-color: var(--preview-secondary-bg, var(--secondary-bg));
    transition: background-color var(--transition-speed);
}
.preview-sidebar {
    width: 30%; background-color: var(--preview-sidebar-bg, var(--sidebar-bg));
    padding: 10px; transition: background-color var(--transition-speed);
}
.preview-sidebar-item { height: 10px; border-radius: 3px; margin-bottom: 8px; background-color: var(--preview-hover-color, var(--hover-color)); }
.preview-content { width: 70%; padding: 10px; }
.preview-accent {
    height: 15px; width: 40%; border-radius: 5px; margin-bottom: 10px;
    background-color: var(--preview-accent-color, var(--accent-color));
    transition: background-color var(--transition-speed);
}
.preview-text-short { height: 10px; width: 80%; border-radius: 3px; margin-bottom: 8px; background-color: var(--preview-text-color, var(--text-color)); }
.preview-text-long { height: 10px; width: 60%; border-radius: 3px; background-color: var(--preview-text-color, var(--text-color)); }


/* Theme Options */
.theme-options { display: flex; flex-wrap: wrap; gap: 10px; }
.theme-btn {
    padding: 10px 15px; border: 1px solid var(--accent-color); background-color: transparent;
    color: var(--accent-color); cursor: pointer; border-radius: 5px; transition: background-color 0.2s, color 0.2s;
}
.theme-btn:hover { background-color: var(--accent-color); color: var(--secondary-bg); }

/* Toggle Switch */
.toggle-switch-container { display: flex; align-items: center; margin-bottom: 10px; }
.switch { position: relative; display: inline-block; width: 60px; height: 34px; margin-right: 10px; }
.switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; }
.slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; }
input:checked + .slider { background-color: var(--accent-color); }
input:checked + .slider:before { transform: translateX(26px); }
.slider.round { border-radius: 34px; }
.slider.round:before { border-radius: 50%; }

/* Page switching */
.page {
    display: none;
}

.page.active {
    display: block;
}

/* --- Form Styles --- */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

#routine-slide-form fieldset, #special-studies-form fieldset {
    border: 1px solid var(--hover-color);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

#routine-slide-form legend, #special-studies-form legend {
    padding: 0 10px;
    font-weight: bold;
    color: var(--accent-color);
}

.form-grid, .form-grid-4-col, .form-grid-3-col {
    display: grid;
    gap: 20px;
}

.form-grid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
}

.form-grid-4-col {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
}

.form-grid-3-col {
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    margin-bottom: 5px;
    font-weight: 500;
}

.form-group input[type="text"],
.form-group input[type="date"],
.form-group input[type="number"],
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid var(--hover-color);
    border-radius: 5px;
    background-color: var(--primary-bg);
    color: var(--text-color);
    box-sizing: border-box; /* Important for width */
    font-family: inherit;
    font-size: inherit;
}

.form-group textarea {
    resize: vertical;
}

/* Pill Selectors */
.pill-select-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.pill-btn {
    padding: 8px 15px;
    border: 1px solid var(--hover-color);
    background-color: var(--primary-bg);
    color: var(--text-color);
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.2s;
}

.pill-btn:hover {
    border-color: var(--accent-color);
}

.pill-btn.active {
    background-color: var(--accent-color);
    color: white;
    border-color: var(--accent-color);
}


/* --- Button Styles --- */
.button-primary, .button-success {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    color: white;
    cursor: pointer;
    font-size: 1em;
}

.button-primary {
    background-color: var(--accent-color);
}

.button-primary:hover {
    opacity: 0.9;
}

.button-success {
    background-color: #27ae60; /* A green color */
}

.button-success:hover {
    background-color: #229954;
}

/* --- DLC Counter Styles --- */
.dlc-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 20px;
}

.nrbc-counter {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

#dlc-total-display, #ss-dlc-total-display { font-weight: bold; font-size: 1.2em; color: var(--accent-color); }

.dlc-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 20px;
    text-align: center;
}

.dlc-cell { display: flex; flex-direction: column; align-items: center; }

.dlc-cell-button {
    width: 100px; /* Increased size */
    height: 100px; /* Increased size */
    border-radius: 50%;
    border: 2px solid var(--hover-color);
    padding: 0;
    cursor: pointer;
    overflow: hidden;
    background-color: var(--primary-bg);
    transition: transform 0.1s, border-color 0.3s;
}

.dlc-cell-button:hover { transform: scale(1.05); border-color: var(--accent-color); }
.dlc-cell-button:active { transform: scale(0.95); }

.cell-icon {
    width: 100%;
    height: 100%;
    background-image: url('images/blood_cells.png');
    background-repeat: no-repeat;
    background-size: 400px 500px; /* Rescaled */
    image-rendering: pixelated;
}

.cell-name { font-weight: 500; margin-top: 8px; font-size: 1em; }
.cell-count { font-weight: bold; font-size: 1.2em; color: var(--accent-color); }

/* Icon positions rescaled for 100px buttons */
.icon-neutrophil { background-position: 0px 0px; }
.icon-lymphocyte { background-position: -100px 0px; }
.icon-monocyte { background-position: -200px 0px; }
.icon-eosinophil { background-position: -300px 0px; }
.icon-basophil { background-position: 0px -100px; }
.icon-erythroid { background-position: 0px -200px; } /* For nRBC */
.icon-band { background-position: -100px -200px; }
.icon-metamyelocyte { background-position: -200px -200px; }

.icon-atypical {
    display: flex; align-items: center; justify-content: center;
    font-size: 3em; font-weight: bold; color: var(--accent-color);
    background-image: none;
}

.summary-display {
    margin-top: 20px;
    padding: 15px;
    background-color: var(--primary-bg);
    border: 1px solid var(--hover-color);
    border-radius: 8px;
    font-size: 1.1em;
    font-weight: bold;
    color: var(--accent-color);
    display: none; /* Hidden by default */
}
.summary-display sub { font-size: 0.8em; }

.nrbc-cell-container {
    border-right: 2px solid var(--hover-color);
    padding-right: 20px;
}